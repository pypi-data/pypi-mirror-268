#!/usr/bin/env bash

#--------------------------------------
set_paths()
{
    if   [[   -z $RK_TOY ]];then
        VENV=$PWD/RK_TOY
	INSTALL=1
    elif [[ ! -d $RK_TOY ]];then
        VENV=$RK_TOY
	INSTALL=1
    elif [[   -d $RK_TOY ]];then
        VENV=$RK_TOY
	INSTALL=0
    fi

    PYTHONPATH+=:$VENV/lib/python3.9/site-packages
    source /cvmfs/sft.cern.ch/lcg/views/LCG_105/x86_64-centos7-gcc11-opt/setup.sh
}
#--------------------------------------
install_sft()
{
    if [[ $INSTALL -eq 0 ]];then
	return
    fi

    mkdir -p $VENV

    pip install                   --prefix $VENV logzero 
    pip install                   --prefix $VENV rx_selection
    pip install --no-dependencies --prefix $VENV rx-differential-crosscheck-fits
    pip install --no-dependencies --prefix $VENV rk-hadmisid-study
    pip install --no-dependencies --prefix $VENV rx_monitor
    pip install --no-dependencies --prefix $VENV rx_hqm
    pip install --no-dependencies --prefix $VENV rx_combinatorial 
    pip install --no-dependencies --prefix $VENV rx_scripts
    pip install --no-dependencies --prefix $VENV rx_tools
    pip install --no-dependencies --prefix $VENV rk_extractor
}
#--------------------------------------
run()
{
    echo "--------------------"
    echo "Running rxe_run_toys with args: $VERS" 
    ./rxe_toys -v $VERS 
    echo "--------------------"
}
#--------------------------------------
VERS=$1
set_paths
install_sft
run

