{"version":3,"file":"js/module_events.importing.5502291b.bundle.js","mappings":"2IA+GGA,OAnGMC,kBAAoB,WACzB,MAAMC,EAAiBC,EAAE,gCACnBC,EAAQD,EAAE,sBACVE,EAAgBF,EAAE,kBAAkBG,OACpCC,EAAeJ,EAAE,iBAAiBG,OAClCE,EAAcL,EAAE,wBAChBM,EAAOP,EAAeQ,KAAK,QAC3BC,EAAqBT,EAAeQ,KAAK,sBAoBzCE,EAAqBC,KAAW,SAASC,GAC7C,MAAMC,EAAiBZ,EAAEa,MAAMZ,EAAMa,kBAAkB,IAGlDH,GAASC,IAAmBX,EAAMM,KAAK,kBAM5CN,EAAMM,KAAK,cAAeK,GAE1BX,EAAMc,WAAW,CACfC,IAAKjB,EAAeQ,KAAK,qBACzBU,OAAQ,OACRC,OAAAA,CAAQX,GACN,GAAIA,EAAKW,QAAS,CAChB,MAAMC,EAAcjB,EAAckB,KAAK,uBACjCC,EAAiBnB,EAAckB,KAAK,0BACpCE,EAAcpB,EAAckB,KAAK,uBACvCD,EAAYI,KAAKhB,EAAKiB,MAAMC,OAC5BJ,EAAeE,KAAKhB,EAAKiB,MAAME,eAAeC,KAAK,QACnDL,EAAYC,MAAKK,EAAAA,EAAAA,wBAAuBrB,EAAKiB,MAAMK,SAAUtB,EAAKiB,MAAMM,SACxE1B,EAAaD,OACbD,EAAc6B,OACd1B,EAAY2B,KAAK,YAAY,EAC/B,MACE5B,EACG2B,OACAX,KAAK,iBACLa,KA/CY,iBADFC,EAgDO3B,EAAK2B,MAAMC,SA9C5BD,EAEAlC,EAAE,SAASoC,OAChBF,EAAMG,KAAI,SAASC,GACjB,MAAMC,EAAQvC,EAAE,YAAYoC,OAAOE,EAAK,IAClCE,EAAQxC,EAAE,QAAQoC,OACtBE,EAAK,GAAGD,KAAI,SAASF,GACnB,OAAOnC,EAAE,QAAQuB,KAAKY,EACxB,KAEF,OAAOnC,EAAE,SAASoC,OAAOG,EAAOC,EAClC,MAoCEtC,EAAcC,OACdE,EAAY2B,KAAK,YAAY,GAlDrC,IAAqBE,CAoDjB,IAEJ,GAAG,KAEU,IAAT5B,IACFD,EAAY2B,KAAK,YAAY,GAC7B/B,EAAMwC,GAAG,SAAU,QAASC,IAAUjC,GAAoB,IAC1DR,EAAMwC,GAAG,QAAS,SAAS,SAASE,GAClCA,EAAEC,iBACFnC,GAAmB,EACrB,KAGW,IAATH,IACFL,EAAMmB,KAAK,8BAA8BqB,GAAG,SAAU,wBAAwB,WAC5E,MAAMI,EAAQ7C,EAAE8C,MACVC,EAAevC,EAAmBqC,EAAMG,OACxCC,EAASJ,EAAMK,QAAQ,eAEzBL,EAAMb,KAAK,WACTe,EAAaI,UACfJ,EAAaI,SAASC,SAAQ,SAASC,GACrCJ,EAAO7B,KAAK,6BAA6BkC,OAAOD,IAAarB,KAAK,WAAW,EAC/E,IAEOe,EAAaQ,aACtBR,EAAaQ,YAAYH,SAAQ,SAASC,GACxCJ,EAAO7B,KAAK,cAAckC,OAAOD,IAAarB,KAAK,WAAW,EAChE,GAEJ,IAGAhC,EAAE,2DAA2DwD,QAAQ,UAErExD,EAAE,iEAAiEwD,QAAQ,UAE/E,C","sources":["webpack:///indico/modules/events/client/js/importing.js"],"sourcesContent":["// This file is part of Indico.\n// Copyright (C) 2002 - 2024 CERN\n//\n// Indico is free software; you can redistribute it and/or\n// modify it under the terms of the MIT License; see the\n// LICENSE file for more details.\n\nimport _ from 'lodash';\n\nimport {serializeDateTimeRange} from 'indico/utils/date';\n\n(function(global) {\n  global.setupImportDialog = function setupImportDialog() {\n    const $formContainer = $('#event-import-form-container');\n    const $form = $('#event-import-form');\n    const $eventDetails = $('#event-details').hide();\n    const $cloneErrors = $('#clone-errors').hide();\n    const $nextButton = $('.clone-action-button');\n    const step = $formContainer.data('step');\n    const clonerDependencies = $formContainer.data('clonerDependencies');\n\n    function errorToHTML(error) {\n      if (typeof error === 'string') {\n        return error;\n      } else {\n        return $('<div>').append(\n          error.map(function(item) {\n            const label = $('<strong>').append(item[0]);\n            const items = $('<ul>').append(\n              item[1].map(function(message) {\n                return $('<li>').text(message);\n              })\n            );\n            return $('<div>').append(label, items);\n          })\n        );\n      }\n    }\n\n    const updateEventDetails = _.debounce(function(force) {\n      const serializedForm = $.param($form.serializeArray(), true);\n\n      // make sure the form was actually changed\n      if (!force && serializedForm === $form.data('initialData')) {\n        return;\n      }\n\n      // set 'intiialData' by hand here, so that the if we're in a 'keyup'\n      // event, the successive 'change' event will receive the updated version\n      $form.data('initialData', serializedForm);\n\n      $form.ajaxSubmit({\n        url: $formContainer.data('event-details-url'),\n        method: 'POST',\n        success(data) {\n          if (data.success) {\n            const $eventTitle = $eventDetails.find('.import-event-title');\n            const $eventCategory = $eventDetails.find('.import-event-category');\n            const $eventDates = $eventDetails.find('.import-event-dates');\n            $eventTitle.text(data.event.title);\n            $eventCategory.text(data.event.category_chain.join(' Â» '));\n            $eventDates.text(serializeDateTimeRange(data.event.start_dt, data.event.end_dt));\n            $cloneErrors.hide();\n            $eventDetails.show();\n            $nextButton.prop('disabled', false);\n          } else {\n            $cloneErrors\n              .show()\n              .find('.message-text')\n              .html(errorToHTML(data.error.message));\n            $eventDetails.hide();\n            $nextButton.prop('disabled', true);\n          }\n        },\n      });\n    }, 300);\n\n    if (step === 1) {\n      $nextButton.prop('disabled', true);\n      $form.on('change', 'input', _.partial(updateEventDetails, false));\n      $form.on('keyup', 'input', function(e) {\n        e.preventDefault();\n        updateEventDetails(false);\n      });\n    }\n\n    if (step === 2) {\n      $form.find('#form-group-selected_items').on('change', 'input[type=checkbox]', function() {\n        const $this = $(this);\n        const dependencies = clonerDependencies[$this.val()];\n        const $field = $this.closest('.form-field');\n\n        if ($this.prop('checked')) {\n          if (dependencies.requires) {\n            dependencies.requires.forEach(function(optionName) {\n              $field.find('[value={0}]:not(:disabled)'.format(optionName)).prop('checked', true);\n            });\n          }\n        } else if (dependencies.required_by) {\n          dependencies.required_by.forEach(function(optionName) {\n            $field.find('[value={0}]'.format(optionName)).prop('checked', false);\n          });\n        }\n      });\n\n      // first check requirements of checked items\n      $('#form-group-selected_items input[type=checkbox]:checked').trigger('change');\n      // then ensure that nothing is checked that shouldn't be checked\n      $('#form-group-selected_items input[type=checkbox]:not(:checked)').trigger('change');\n    }\n  };\n})(window);\n"],"names":["window","setupImportDialog","$formContainer","$","$form","$eventDetails","hide","$cloneErrors","$nextButton","step","data","clonerDependencies","updateEventDetails","_debounce","force","serializedForm","param","serializeArray","ajaxSubmit","url","method","success","$eventTitle","find","$eventCategory","$eventDates","text","event","title","category_chain","join","serializeDateTimeRange","start_dt","end_dt","show","prop","html","error","message","append","map","item","label","items","on","_partial","e","preventDefault","$this","this","dependencies","val","$field","closest","requires","forEach","optionName","format","required_by","trigger"],"sourceRoot":""}