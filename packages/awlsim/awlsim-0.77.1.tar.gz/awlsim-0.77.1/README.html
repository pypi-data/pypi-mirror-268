<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">README</h1>
</header>
<h1
id="awlsim---s7-compatible-programmable-logic-controller-plcsps">Awlsim
- S7 compatible Programmable Logic Controller (PLC/SPS)</h1>
<p>Awlsim is a free Step 7 compatible Programmable Logic Controller,
that supports the automation languages AWL/STL and FUP/FBD. Awlsim
itself is written in Python.</p>
<p>The latest version of Awlsim can be downloaded at the <a
href="https://bues.ch/a/awlsim">official Awlsim site</a>.</p>
<p><a href="https://bues.ch/cgit/awlsim.git/">Main git
repository</a></p>
<p><a href="https://github.com/mbuesch/awlsim">Github / issue tracking /
pull requests</a></p>
<h2 id="awlsim---programmable-logic-controller-plcsps">Awlsim -
Programmable Logic Controller (PLC/SPS)</h2>
<p>Awlsim is a free Step 7 compatible Programmable Logic Controller,
that supports the automation languages AWL/STL and FUP/FBD. Awlsim
itself is written in Python. The speed of execution ranges from several
ten thousand AWL/STL instructions per second on slow embedded machines
to a couple of million instructions per second on faster computers.</p>
<p>AWL/STL programs on PLCs are used for automation of industrial
processes. However Awlsim is very flexible, so it can be used for other
purposes beyond industrial applications, too. Awlsim aims to be
compatible with the industry standard S7 software on the AWL/STL
level.</p>
<p>Awlsim can emulate CPUs with two and four accumulator registers
(S7-3xx and S7-4xx). Compatibility to S7 hardware is a task taken
seriously by the Awlsim project. We want to be as close as possible to
the real PLC hardware with our AWL/STL code execution. For this reason
Awlsim ships an extensive selftest suite. Missing features and
differences between Awlsim and Step 7 are documented in the <a
href="COMPATIBILITY.html">COMPATIBILITY documentation</a> and <a
href="TODO.html">TODO documentation</a> files.</p>
<h2 id="quick-start-tutorial">Quick start tutorial</h2>
<p>See the <a href="QUICK-START.html">quick start tutorial</a> for a
simple example on how to use Awlsim in simulator mode. In simulator mode
Awlsim can be run on any desktop PC. No special hardware is
required.</p>
<h2 id="example-project">Example project</h2>
<p>If you don’t know where to start, you can find an example project in
the <code>examples</code> directory as <code>EXAMPLE.awlpro</code>. You
can easily run this example in simulation mode without the need for
special hardware.</p>
<h2 id="git-repository">Git repository</h2>
<p>The latest development version of Awlsim can be fetched with git:</p>
<pre>
git clone https://git.bues.ch/git/awlsim.git
cd awlsim
</pre>
<p>After cloning the main repository the git submodules must also be
fetched. The following helper script can be used:</p>
<pre>
./maintenance/update-submodules
</pre>
<h2 id="dependencies">Dependencies</h2>
<p>Awlsim depends on</p>
<ul>
<li><a href="https://python.org">Python</a> 3.4 or later (or
alternatively Python 2.7)</li>
<li><a
href="https://www.riverbankcomputing.com/software/pyqt/intro">PyQT 5</a>
or alternatively <a href="https://wiki.qt.io/Qt_for_Python">PySide
2</a></li>
<li><a href="http://cffi.readthedocs.org/">CFFI</a></li>
</ul>
<p>These packages can be installed with pip:</p>
<pre>
pip3 install --upgrade PyQt5
pip3 install --upgrade cffi
</pre>
<p>If building and using Awlsim with Cython acceleration is desired,
Cython must also be installed:</p>
<pre>
pip3 install --upgrade Cython
</pre>
<p>On Windows all Awlsim dependencies can be installed by double
clicking the shipped installer script:
<em>maintenance-install-dependencies.cmd</em></p>
<p>For Debian Linux users the script
<em>maintenance/deb-dependencies-install.sh</em> installs all required
and optional runtime and build dependencies.</p>
<h2 id="directory-structure">Directory structure</h2>
<p>The Awlsim Git repository and source archive
<code>awlsim-x.yz.tar.bz2</code> contain lots of files and directories.
Here is an overview of the main files and directories and their
purpose:</p>
<h3 id="main-executables">Main executables</h3>
User interface executables. The main user executable is
<code>awlsim-gui</code>.
<pre>
.  awlsim-client             : Command line client tool.
.  awlsim-gui                : Graphical user interface. This is the main user frontend.
.  awlsim-linuxcnc-hal       : LinuxCNC HAL module executable.
.  awlsim-proupgrade         : Command line tool to update .awlpro file formats.
.  awlsim-server             : Command line server tool.
.  awlsim-symtab             : Command line tool to parse symbol tables (.ASC).
.  awlsim-test               : Command line tool for unit testing.
.                              See tests/run.sh for execution of unit tests.
.  awlsim-win.cmd            : Windows wrapper for awlsim-gui.
</pre>
<h3 id="documentation">Documentation</h3>
These files and directories contain useful information about Awlsim.
<pre>
.  doc/                      : Main documentation.
.  doc/fup/                  : Awlsim FUP language and editor documentation.
.  examples/                 : Various example projects and feature demonstrations.
.  COMPATIBILITY.md|html     : S7 compatibility documentation.
.  COPYING.txt               : Main license.
.  DEVELOPMENT.md|html       : How to enhance and develop Awlsim.
.  QUICK-START.md|html       : Quick start tutorial.
.  README.md|html            : Main README document.
.  TODO.md|html              : TODO list.
</pre>
<h3 id="main-modules">Main modules</h3>
The main modules implement most of Awlsim’s functionality.
<pre>
.  awlsim/                   : Main Awlsim Python-module directory. This is where the magic happens.
.  awlsim/awlcompiler        : AWL compiler.
.  awlsim/awloptimizer       : AWL optimizer.
.  awlsim/common             : Common libraries, modules and helper functions.
.  awlsim/core               : AWL interpreter core. This is where the AWL program is executed.
.  awlsim/core/instructions  : Implementation of AWL instructions.
.  awlsim/core/systemblocks  : Implementation of SFCs and SFBs.
.  awlsim/coreclient         : Client library to connect to coreserver.
.  awlsim/coreserver         : Server library to provide AWL interpreter core access via networking.
.  awlsim/fupcompiler        : FUP compiler.
.  awlsim/gui                : Graphical user interface implementation (Qt).
.  awlsim/library            : AWL block (FC and FB) libraries.
.  awlsim/library/iec        : Implementation of IEC FCs and FBs.
.  awlsim_loader/            : Import wrapper for the main Awlsim Python-module.
.                              This is used to automatically load Cython optimized modules.
.  libs/                     : External libraries used for running or testing Awlsim.
.  progs/                    : External programs used in Awlsim.
.  submodules/               : Git submodules used for running Awlsim.
.                              See  man git-submodule  for general help about Git submodules.
.  submodules/pyprofibus/    : PROFIBUS-DP implementation.
.  tests/                    : Unit test cases.
.  tests/run.sh              : Main interface to run unit tests. Please see --help
</pre>
<h3 id="hardware-support-modules">Hardware support modules</h3>
The hardware modules are the glue between the Awlsim core and the real
world. The hardware modules are invoked before and after running the
user cycle (OB 1).
<pre>
.  awlsimhw_debug/           : Hardware module for unit tests. Do not use in production.
.  awlsimhw_dummy/           : Dummy no-operation hardware module for testing, debugging or simulation.
.  awlsimhw_linuxcnc/        : LinuxCNC hardware support module.
.  awlsimhw_pixtend/         : PiXtend hardware support module.
.  awlsimhw_pyprofibus/      : PROFIBUS-DP hardware support module.
.  awlsimhw_pyprofibus.conf  : Configuration file for awlsimhw_pyprofibus.
.  awlsimhw_rpigpio/         : Raspberry Pi GPIO hardware support module.
</pre>
<h3 id="misc">Misc</h3>
<pre>
.  awlsim-server.service     : Systemd unit for awlsim-server.
.  debian/                   : Debian packaging support.
.  maintenance/              : Maintainer scripts.
.  misc/                     : Miscellaneous scripts and files.
.  setup.py                  : Python package build script. This also builds the Cython modules.
</pre>
<h2 id="fup---funktionsplan---function-block-diagram">FUP -
Funktionsplan - Function block diagram</h2>
<p>Awlsim supports programming in an S7-FUP like language. See <a
href="doc/fup/FUP.html">the FUP documentation</a> for more information
about Awlsim’s implementation of FUP.</p>
<h2 id="environment-variables">Environment variables</h2>
<p>The following environment variables control Awlsim’s basic
behavior:</p>
<ul>
<li><p><code>AWLSIM_GUI</code><br /> <code>=auto</code> Automatically
select the best GUI framework (default)<br /> <code>=pyside</code> Use
PySide as GUI framework.<br /> <code>=pyqt</code> Use PyQt as GUI
framework.<br /></p></li>
<li><p><code>AWLSIM_CYTHON</code><br /> <code>=0</code> Do not attempt
to use Cython core (default)<br /> <code>=1</code> Attempt to use Cython
core, but fall back to Python<br /> <code>=2</code> Enforce Cython
core<br /></p></li>
<li><p><code>AWLSIM_SCHED</code><br /> <code>=default</code> Do not
change the scheduling policy. Keep the policy that was assigned to
Awlsim by the operating system. (default)<br /> <code>=normal</code> Use
the normal non-realtime OS scheduling.<br /> <code>=fifo</code> Use FIFO
realtime scheduling (<code>SCHED_FIFO</code>).<br /> <code>=rr</code>
Use Round-robin realtime scheduling (<code>SCHED_RR</code>).<br />
<code>=deadline</code> Use Deadline realtime scheduling
(<code>SCHED_DEADLINE</code>).<br /> <code>=realtime</code> Use a
realtime scheduling algorithm that performs best in most situations. The
actual algorithm selection might change between Awlsim
releases.<br /></p>
<p>The suffix <code>-if-multicore</code> can be appended to the options
<code>fifo</code>, <code>rr</code>, <code>deadline</code> and
<code>realtime</code>. That will trigger a fall back to
<code>normal</code>, if the system is single-core (has only one
CPU).</p></li>
<li><p><code>AWLSIM_PRIO</code><br /> <code>=default</code> Do not
change the priority (default).<br /> <code>=1-99</code> Set the
scheduling priority. The meaning of the priority depends on the
operating system and the selected scheduling algorithm. See
<code>AWLSIM_SCHED</code>.<br /></p></li>
<li><p><code>AWLSIM_AFFINITY</code><br /> <code>=0,2,...</code> Comma
separated list of host CPU cores to run on. Default: all
cores.<br /></p></li>
<li><p><code>AWLSIM_MLOCK</code><br /> <code>=0</code> Do not try to
mlockall. See man 2 mlockall. (default).<br /> <code>=1</code> Try to
mlockall all current and future memory. See man 2 mlockall.<br />
<code>=2</code> mlockall all current and future memory. Abort on
failure. See man 2 mlockall.<br /></p></li>
<li><p><code>AWLSIM_PROFILE</code><br /> <code>=0</code> Disable
profiling (default)<br /> <code>=1</code> Enable core cycle
profiling<br /> <code>=2</code> Enable full core profiling (including
startup)<br /></p></li>
<li><p><code>AWLSIM_COVERAGE</code><br /> <code>=DATAFILE</code> Enable
code coverage tracing.<br /></p></li>
<li><p><code>AWLSIM_GCMODE</code><br /> <code>=realtime</code> Enable
manual garbage collection, if realtime scheduling is enabled.
(default)<br /> <code>=auto</code> Always use automatic garbage
collection.<br /> <code>=manual</code> Always use manual garbage
collection.<br /></p></li>
<li><p><code>AWLSIM_GCTHRES</code><br /> <code>=700,1,1</code> <br /> A
comma separated string with up to 3 integers.<br /> Each integer
corresponding to the Python garbage collector generation 0 to 2
thresholds for manual garbage collection.<br /> A threshold value of 0
disables garbage collection. (not recommended)<br /></p></li>
<li><p><code>AWLSIM_GCCYCLE</code><br /> <code>=64</code> <br /> The
number of OB1 cycles it takes to trigger a manual garbage
collection.<br /></p></li>
</ul>
<h2 id="environment-variables-during-build-setup.py">Environment
variables during build (setup.py)</h2>
<p>The following environment variables control Awlsim’s build (setup.py)
behavior:</p>
<ul>
<li><p><code>AWLSIM_FULL_BUILD</code><br /> <code>=0</code> Do not
include scripts that are not necessary on this platform. (default)<br />
<code>=1</code> Include all scripts; also those that aren’t required on
the platform.<br /></p></li>
<li><p><code>AWLSIM_CYTHON_BUILD</code><br /> <code>=0</code> Do not
build any Cython modules. (default on non-Posix)<br /> <code>=1</code>
Build Cython modules. (default on Posix)<br /></p></li>
<li><p><code>AWLSIM_CYTHON_PARALLEL</code><br /> <code>=0</code> Do not
use parallel compilation for Cython modules.<br /> <code>=1</code>
Invoke multiple compilers in parallel (faster on multicore).
(default)<br /></p></li>
<li><p><code>AWLSIM_PROFILE</code><br /> <code>=0</code> Do not enable
profiling support in compiled Cython modules. (default)<br />
<code>=1</code> Enable profiling support in compiled Cython
modules.<br /></p></li>
<li><p><code>AWLSIM_DEBUG_BUILD</code><br /> <code>=0</code> Do not
enable debugging support in compiled Cython modules. (default)<br />
<code>=1</code> Enable debugging support in compiled Cython
modules.<br /></p></li>
</ul>
<h2 id="building-awlsim">Building Awlsim</h2>
<p>Awlsim can be run from the source directory in interpreted Python
mode without building it. Just <code>cd</code> into the Awlsim source
directory and execute the desired main executable
(e.g. <code>./awlsim-gui</code> or <code>./awlsim-server</code>
etc…).</p>
<p>The accelerated Cython libraries can be built with the standard
Python <code>./setup.py build</code> command.</p>
<p>For convenience there also is a helper script
<code>./maintenance/build.sh</code>, which will do everything right to
build Awlsim. That can be used instead of calling setup.py directly.</p>
<p>There also is <code>./maintenance/build-noopt.sh</code>. That builds
Cython modules without optimization. The build is much faster, but the
resulting Cython libraries will be much slower. This is useful for
development. Do not use this for production.</p>
<h2 id="pilc---the-raspberry-pi-plc">PiLC - The Raspberry Pi PLC</h2>
<p>If you want to use PiLC, please also see the <a
href="https://bues.ch/a/pilc">PiLC documentation</a>.</p>
<h2 id="building-debian-raspbian-pilc-.deb-packages">Building Debian /
Raspbian / PiLC .deb packages</h2>
<p>Installing or upgrading Awlsim on a Debian based system is easy. The
<code>debuild</code> can be used to build the .deb packages. Just run
the following commands to build all Awlsim .deb packages:</p>
<pre>
cd path/to/awlsim                                 # Go to Awlsim source directory
sudo ./maintenance/deb-dependencies-install.sh    # This installs all dependencies
debuild -uc -us                                   # Build all Awlsim .deb packages
sudo ./maintenance/deb-install.sh ..              # Install or upgrade all Awlsim .deb packages
</pre>
<p>The .deb files will be put into the parent directory of the Awlsim
source directory.</p>
<p>If you get the following build failure during build:</p>
<p><code>/usr/include/features.h:xxx:xx: fatal error: sys/cdefs.h: No such file or directory</code></p>
<p>this can be fixed by re-installing the libc development package:</p>
<p><code>sudo apt install --reinstall libc-dev</code></p>
<h2 id="development">Development</h2>
<p>Information about Awlsim development can be found in <a
href="DEVELOPMENT.html">the Awlsim development documentation</a>.</p>
<h2 id="license-copyright">License / Copyright</h2>
<p>Copyright (C) Michael Büsch / et al.</p>
<p>Awlsim is Open Source Free Software licensed under the GNU General
Public License v2+. That means it’s available in full source code and
you are encouraged to improve it and contribute your changes back to the
community. Awlsim is free of charge, too.</p>
</body>
</html>
