"use strict";(self.webpackChunk_jupytercad_jupytercad_core=self.webpackChunk_jupytercad_jupytercad_core||[]).push([[413,794],{9794:(e,o,r)=>{r.r(o),r.d(o,{OccParser:()=>t,OccWorker:()=>h});class t{constructor(e){this._occ=self.occ,this._showEdge=!0,this._shapeList=e}execute(){const e={};return this._shapeList.forEach((o=>{const{shapeData:r,jcObject:t}=o,{occShape:n,metadata:s}=r;if(!n)return;new this._occ.BRepMesh_IncrementalMesh_2(n,.1,!1,.5,!0);const a=this._build_face_mesh(n);let i=[];this._showEdge&&(i=this._build_edge_mesh(n));const p=this._build_wire_mesh(n,.1);e[t.name]={jcObject:t,faceList:a,edgeList:[...i,...p],meta:s}})),e}_build_wire_mesh(e,o){const r=[],t=this._occ,n=new t.TopExp_Explorer_2(e,t.TopAbs_ShapeEnum.TopAbs_EDGE,t.TopAbs_ShapeEnum.TopAbs_SHAPE);for(n.Init(e,t.TopAbs_ShapeEnum.TopAbs_EDGE,t.TopAbs_ShapeEnum.TopAbs_SHAPE);n.More();){const e=t.TopoDS.Edge_1(n.Current()),s=new t.TopLoc_Location_1,a=new t.BRepAdaptor_Curve_2(e),i=new t.GCPnts_TangentialDeflection_2(a,o,.1,2,1e-9,1e-7),p=new Array(3*i.NbPoints());for(let e=0;e<i.NbPoints();e++){const o=i.Value(e+1).Transformed(s.Transformation());p[3*e+0]=o.X(),p[3*e+1]=o.Y(),p[3*e+2]=o.Z()}r.push({vertexCoord:p,numberOfCoords:3*i.NbPoints()}),n.Next()}return r}_build_face_mesh(e){const o=[],r=[],t=this._occ,n=new t.TopExp_Explorer_2(e,t.TopAbs_ShapeEnum.TopAbs_FACE,t.TopAbs_ShapeEnum.TopAbs_SHAPE);for(n.Init(e,t.TopAbs_ShapeEnum.TopAbs_FACE,t.TopAbs_ShapeEnum.TopAbs_SHAPE);n.More();){const e=t.TopoDS.Face_1(n.Current()),s=new t.TopLoc_Location_1,a=t.BRep_Tool.Triangulation(e,s,0);if(a.IsNull()){console.error("Encountered Null Face!"),n.Next();continue}const i={vertexCoord:[],normalCoord:[],triIndexes:[],numberOfTriangles:0},p=new t.Poly_Connect_2(a),c=a.get(),d=c.NbNodes();i.vertexCoord=new Array(3*d);for(let e=0;e<d;e++){const o=c.Node(e+1).Transformed(s.Transformation());i.vertexCoord[3*e+0]=o.X(),i.vertexCoord[3*e+1]=o.Y(),i.vertexCoord[3*e+2]=o.Z()}const _=e.Orientation_1(),u=new t.TColgp_Array1OfDir_2(1,d);t.StdPrs_ToolTriangulatedShape.Normal(e,p,u),i.normalCoord=new Array(3*u.Length());for(let e=0;e<u.Length();e++){const o=u.Value(e+1).Transformed(s.Transformation());i.normalCoord[3*e+0]=o.X(),i.normalCoord[3*e+1]=o.Y(),i.normalCoord[3*e+2]=o.Z()}const l=c.NbTriangles();i.triIndexes=new Array(3*l);let h=0;for(let e=1;e<=a.get().NbTriangles();e++){const o=c.Triangle(e);let r=o.Value(1),n=o.Value(2);const s=o.Value(3);if(_!==t.TopAbs_Orientation.TopAbs_FORWARD){const e=r;r=n,n=e}i.triIndexes[3*h+0]=r-1,i.triIndexes[3*h+1]=n-1,i.triIndexes[3*h+2]=s-1,h++}i.numberOfTriangles=h,o.push(i),r.push(a),n.Next()}return o}_build_edge_mesh(e){const o=this._occ,r=[],t=new o.TopTools_IndexedMapOfShape_1;o.TopExp.MapShapes_1(e,o.TopAbs_ShapeEnum.TopAbs_EDGE,t);const n=new o.TopTools_IndexedDataMapOfShapeListOfShape_1;o.TopExp.MapShapesAndAncestors(e,o.TopAbs_ShapeEnum.TopAbs_EDGE,o.TopAbs_ShapeEnum.TopAbs_FACE,n);for(let e=1;e<=n.Extent();e++){if(0===n.FindFromIndex(e).Extent())continue;const s=o.TopoDS.Edge_1(t.FindKey(e));let a=new o.gp_Trsf_1;const i=new o.TopLoc_Location_1,p=o.BRep_Tool.Polygon3D(s,i),c={vertexCoord:[],numberOfCoords:0};let d;if(p.IsNull()){const r=o.TopoDS.Face_1(n.FindFromIndex(e).First_1()),t=o.BRep_Tool.Triangulation(r,i,0);i.IsIdentity()||(a=i.Transformation());const p=o.BRep_Tool.PolygonOnTriangulation_1(s,t,i);if(p.IsNull())continue;d=p.get().NbNodes(),c.numberOfCoords=d,c.vertexCoord=new Array(3*d);const _=p.get().Nodes(),u=t.get();for(let e=_.Lower();e<=_.Upper();e++){const o=u.Node(_.Value(e));o.Transform(a);const r=e-1;c.vertexCoord[3*r+0]=o.X(),c.vertexCoord[3*r+1]=o.Y(),c.vertexCoord[3*r+2]=o.Z()}}else{i.IsIdentity()||(a=i.Transformation()),d=p.get().NbNodes(),c.numberOfCoords=d,c.vertexCoord=new Array(3*d);const e=p.get().Nodes();for(let o=0;o<d;o++){const r=e.Value(o+1);r.Transform(a),c.vertexCoord[3*o+0]=r.X(),c.vertexCoord[3*o+1]=r.Y(),c.vertexCoord[3*o+2]=r.Z()}}r.push(c)}return r}}var n,s=r(3037),a=r(7262),i=new Uint8Array(16);function p(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}const c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var d=[],_=0;_<256;++_)d.push((_+256).toString(16).substr(1));const u=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(d[e[o+0]]+d[e[o+1]]+d[e[o+2]]+d[e[o+3]]+"-"+d[e[o+4]]+d[e[o+5]]+"-"+d[e[o+6]]+d[e[o+7]]+"-"+d[e[o+8]]+d[e[o+9]]+"-"+d[e[o+10]]+d[e[o+11]]+d[e[o+12]]+d[e[o+13]]+d[e[o+14]]+d[e[o+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&c.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r},l=function(e,o,r){var t=(e=e||{}).random||(e.rng||p)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,o){r=r||0;for(var n=0;n<16;++n)o[r+n]=t[n];return o}return u(t)};class h{constructor(e){this._ready=new a.PromiseDelegate,this._messageChannels=new Map,this._nativeWorker=e.worker}get ready(){return this._ready.promise}register(e){const{messageHandler:o,thisArg:r}=e,t=l(),n=new MessageChannel;r&&o.bind(r),n.port1.onmessage=this._handlerFactory(o),this._messageChannels.set(t,n);const a={id:t,action:s.WorkerAction.REGISTER,payload:{id:t}};return this._nativeWorker.postMessage(a,[n.port2]),t}unregister(e){this._messageChannels.delete(e)}postMessage(e){this._nativeWorker.postMessage(e)}_handlerFactory(e){return o=>{o.data.action===s.MainAction.INITIALIZED&&this._ready.resolve(),e(o.data)}}}}}]);