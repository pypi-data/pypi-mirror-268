import{d as j,r as m,o as Z,a as k,b as l,c as d,e,f as a,w as de,g as o,h as _,i as E,t as x,j as I,F as G,E as ae,_ as L,u as F,k as se,l as ue,m as J,n as X,p as K,q as W,s as ne,v as B,x as _e,y as A,z as Y}from"./index-l57H1Ofi.js";import{h as O}from"./axios--FnjuHWf.js";/* empty css                                                                       */import{_ as he}from"./HomeView.vue_vue_type_script_setup_true_lang-fo5BGHyi.js";const me={style:{padding:"10px 10px"}},fe={key:0},pe={key:1},ve=e("br",null,null,-1),ye={key:2,style:{color:"#909399","font-size":"12px"}},we=j({__name:"ContactsList",emits:["wxid"],setup(t,{emit:v}){const i=m([]),r=async()=>{try{return await O.post("/api/recent_user_list",{})}catch(w){return console.error("Error fetching data:",w),[]}},h=async(w="")=>{try{return await O.post("/api/user_list",{word:w})}catch(D){return console.error("Error fetching data:",D),[]}};Z(async()=>{try{i.value=await r()}catch(w){return console.error("Error fetching data:",w),[]}});const u=m(""),s=async()=>{try{if(u.value===""){i.value=await r();return}i.value=await h(u.value)}catch(w){return console.error("Error fetching data:",w),[]}},c=v,b=w=>{w!==void 0&&c("wxid",w.wxid)};return(w,D)=>{const z=k("el-input"),p=k("el-button"),U=k("el-avatar"),H=k("el-table-column"),R=k("el-table");return l(),d("div",null,[e("div",me,[a(z,{placeholder:"请输入关键字",modelValue:u.value,"onUpdate:modelValue":D[0]||(D[0]=S=>u.value=S),onKeyup:de(s,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),a(p,{type:"primary",onClick:s,style:{width:"50px"}},{default:o(()=>[_("搜索")]),_:1})]),a(R,{data:i.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:b},{default:o(()=>[a(H,{width:"57"},{default:o(({row:S})=>[S.headImgUrl!==""?(l(),E(U,{key:0,size:33,src:"/api/imgsrc/"+S.headImgUrl},null,8,["src"])):(l(),E(U,{key:1,size:33},{default:o(()=>[_(" 群聊 ")]),_:1}))]),_:1}),a(H,{width:"190"},{default:o(({row:S})=>[S.remark!==null&&S.remark!==""?(l(),d("span",fe,x(S.remark),1)):(l(),d("span",pe,x(S.nickname),1)),ve,S.LastReadedCreateTime!==void 0&&S.LastReadedCreateTime!==null?(l(),d("span",ye,x(S.LastReadedCreateTime),1)):I("",!0)]),_:1})]),_:1},8,["data"])])}}}),ge=j({__name:"ChatRecprdsHeader",props:{userData:{type:Object,required:!0}},emits:["exporting"],setup(t,{emit:v}){const i=m(!1),r=async()=>{if(i.value){console.log("正在获取实时消息，请稍后再试!");return}i.value=!0;try{const u=await O.post("/api/realtimemsg",{});return i.value=!1,ae({title:"Success",message:"获取实时消息成功!",type:"success"}),u}catch(u){return i.value=!1,ae({title:"Error",message:"获取实时消息失败!",type:"error"}),console.error("Error fetching data:",u),[]}},h=v,$=()=>{h("exporting",!0)};return(u,s)=>{const c=k("el-text"),b=k("el-col"),w=k("el-row");return l(),d(G,null,[a(w,{gutter:5,style:{width:"100%"}},{default:o(()=>[a(b,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("wxid:")]),_:1}),_("  "),a(c,{class:"data_color mx-1",truncated:"",title:t.userData.wxid},{default:o(()=>[_(x(t.userData.wxid),1)]),_:1},8,["title"])]),_:1}),a(b,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("账号:")]),_:1}),_("  "),a(c,{class:"data_color mx-1",truncated:"",title:t.userData.account},{default:o(()=>[_(x(t.userData.account),1)]),_:1},8,["title"])]),_:1}),a(b,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("昵称:")]),_:1}),_("  "),a(c,{class:"data_color mx-1",truncated:"",title:t.userData.nickname},{default:o(()=>[_(x(t.userData.nickname),1)]),_:1},8,["title"])]),_:1}),a(b,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("备注:")]),_:1}),_("  "),a(c,{class:"data_color mx-1",truncated:"",title:t.userData.remark},{default:o(()=>[_(x(t.userData.remark),1)]),_:1},8,["title"])]),_:1})]),_:1}),a(w,{gutter:5,style:{width:"100%"}},{default:o(()=>[a(b,{span:3,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("数量:")]),_:1}),_("  "),a(c,{class:"data_color mx-1",truncated:"",title:t.userData.msg_count},{default:o(()=>[_(x(t.userData.msg_count),1)]),_:1},8,["title"])]),_:1}),a(b,{span:15,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("描述:")]),_:1}),_("  "),a(c,{class:"data_color mx-1",truncated:"",title:t.userData.describe},{default:o(()=>[_(x(t.userData.describe),1)]),_:1},8,["title"])]),_:1}),a(b,{span:3,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"button_color mx-1 underline",truncated:"",onClick:s[0]||(s[0]=D=>{r()})},{default:o(()=>[_("实时消息 "),i.value?(l(),d(G,{key:0},[_("(获取中)")],64)):I("",!0)]),_:1})]),_:1}),a(b,{span:3,style:{"white-space":"nowrap"}},{default:o(()=>[a(c,{class:"button_color mx-1 underline",truncated:"",onClick:s[1]||(s[1]=D=>{$()})},{default:o(()=>[_("导出")]),_:1})]),_:1})]),_:1})],64)}}}),xe=L(ge,[["__scopeId","data-v-7bc26671"]]),be={class:"chat-content"},ke={key:0,class:"word"},$e=["src"],Se={class:"info"},De={class:"time"},Te=["innerHTML"],Ue={key:1,class:"word-my"},Ve={class:"info"},Ce={class:"time"},Me=["innerHTML"],Ee=["src"],ze=j({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const v=i=>(i=i.replace(/\n/g,"<br>"),new DOMParser().parseFromString(i,"text/html").body.innerHTML);return(i,r)=>(l(),d("div",be,[t.is_sender?(l(),d("div",Ue,[e("div",Ve,[e("p",Ce,x(t.direction),1),e("div",{class:"info-content",innerHTML:v(t.content)},null,8,Me)]),e("img",{src:t.headUrl},null,8,Ee)])):(l(),d("div",ke,[e("img",{src:t.headUrl},null,8,$e),e("div",Se,[e("p",De,x(t.direction),1),e("div",{class:"info-content",innerHTML:v(t.content)},null,8,Te)])]))]))}}),He=L(ze,[["__scopeId","data-v-d930be9e"]]),Re={class:"chat-content"},Ie={key:0,class:"word"},je=["src"],Oe={class:"info"},qe={class:"time"},Le={class:"demo-image__preview"},Pe={key:1,class:"word-my"},Fe={class:"info"},Ne={class:"time"},Be={class:"demo-image__preview"},Ae=["src"],Ye=j({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(v,i)=>{const r=k("el-image");return l(),d("div",Re,[t.is_sender?(l(),d("div",Pe,[e("div",Fe,[e("p",Ne,x(t.direction),1),e("div",Be,[a(r,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Ae)])):(l(),d("div",Ie,[e("img",{src:t.headUrl},null,8,je),e("div",Oe,[e("p",qe,x(t.direction),1),e("div",Le,[a(r,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),We=L(Ye,[["__scopeId","data-v-24d6aaa0"]]),Ke={class:"chat-content"},Ge={key:0,class:"word"},Je=["src"],Qe={class:"info"},Xe={class:"time"},Ze={class:"demo-video__preview"},et={controls:"",width:"30%"},tt=["src"],at={key:1,class:"word-my"},st={class:"info"},lt={class:"time"},nt={class:"demo-video__preview"},ot={controls:"",width:"50%"},it=["src"],rt=["src"],ct=j({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(v,i)=>(l(),d("div",Ke,[t.is_sender?(l(),d("div",at,[e("div",st,[e("p",lt,x(t.direction),1),e("div",nt,[e("video",ot,[e("source",{src:t.src,type:"video/mp4"},null,8,it)])])]),e("img",{src:t.headUrl},null,8,rt)])):(l(),d("div",Ge,[e("img",{src:t.headUrl},null,8,Je),e("div",Qe,[e("p",Xe,x(t.direction),1),e("div",Ze,[e("video",et,[e("source",{src:t.src,type:"video/mp4"},null,8,tt)])])])]))]))}}),dt=L(ct,[["__scopeId","data-v-5aa79515"]]),ut={class:"chat-content"},_t={key:0,class:"word"},ht=["src"],mt={class:"info"},ft={class:"time"},pt={controls:"",style:{"background-color":"#fff"}},vt=["src"],yt={key:1,class:"word-my"},wt={class:"info"},gt={class:"time"},xt={controls:"",style:{"background-color":"#95EC69"}},bt=["src"],kt=["src"],$t=j({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(t){return(v,i)=>(l(),d("div",ut,[t.is_sender?(l(),d("div",yt,[e("div",wt,[e("p",gt,x(t.direction),1),e("audio",xt,[e("source",{src:t.src,type:"audio/wav"},null,8,bt)]),a(F(se),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:t.headUrl},null,8,kt)])):(l(),d("div",_t,[e("img",{src:t.headUrl},null,8,ht),e("div",mt,[e("p",ft,x(t.direction),1),e("audio",pt,[e("source",{src:t.src,type:"audio/wav"},null,8,vt)]),a(F(se),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),St=L($t,[["__scopeId","data-v-0d0f2cd4"]]),Dt={class:"chat-content"},Tt={key:0,class:"word"},Ut=["src"],Vt={class:"info"},Ct={class:"time"},Mt={style:{float:"left"}},Et=["href"],zt={key:1,class:"word-my"},Ht={class:"info"},Rt={class:"time"},It={style:{float:"right"}},jt=["href"],Ot=["src"],qt=j({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){const v=t,i=m(""),r=ue({file_name:String,file_size:Number,file_size_unit:String});Z(async()=>{console.log("文件加载中");const $=await h(v.src);r.file_name=$.file_name,r.file_size=Number($.file_size)/1024,r.file_size<1024?r.file_size_unit="kb":(r.file_size=r.file_size/1024,r.file_size_unit="mb"),r.file_size=Number($.file_size)/1024,i.value=`/api/file/${v.src}`});const h=async $=>{try{return await O.post("/api/file_info",{file_path:$})}catch(u){return console.error("Error fetching file_info:",u),""}};return($,u)=>{const s=k("el-card");return l(),d("div",Dt,[t.is_sender?(l(),d("div",zt,[e("div",Ht,[e("p",Rt,x(t.direction),1),e("div",It,[a(s,{shadow:"hover",style:{width:"fit-content"}},{default:o(()=>[_("文件 ： "),e("a",{href:i.value,download:""},x(r.file_name),9,jt),e("div",null,[_(" 文件大小："),e("span",null,x(r.file_size)+x(r.file_size_unit),1)])]),_:1})])]),e("img",{src:t.headUrl},null,8,Ot)])):(l(),d("div",Tt,[e("img",{src:t.headUrl},null,8,Ut),e("div",Vt,[e("p",Ct,x(t.direction),1),e("div",Mt,[a(s,{shadow:"hover",style:{width:"fit-content"}},{default:o(()=>[_("文件 ： "),e("a",{href:i.value,download:""},x(r.file_name),9,Et),e("div",null,[_(" 文件大小："),e("span",null,x(r.file_size)+x(r.file_size_unit),1)])]),_:1})])])]))])}}}),Lt=L(qt,[["__scopeId","data-v-e797f204"]]),Pt={class:"chat-content"},Ft={key:0,class:"word"},Nt=["src"],Bt={class:"info"},At={class:"time"},Yt={class:"demo-image__preview"},Wt={key:1,class:"word-my"},Kt={class:"info"},Gt={class:"time"},Jt={class:"demo-image__preview"},Qt=["src"],Xt=j({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(v,i)=>{const r=k("el-image");return l(),d("div",Pt,[t.is_sender?(l(),d("div",Wt,[e("div",Kt,[e("p",Gt,x(t.direction),1),e("div",Jt,[a(r,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Qt)])):(l(),d("div",Ft,[e("img",{src:t.headUrl},null,8,Nt),e("div",Bt,[e("p",At,x(t.direction),1),e("div",Yt,[a(r,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Zt=L(Xt,[["__scopeId","data-v-ad34c109"]]),ea={class:"chat-content"},ta={key:0,class:"word"},aa=["src"],sa={class:"info"},la={class:"time"},na=["innerHTML"],oa={key:1,class:"word-my"},ia={class:"info"},ra={class:"time"},ca=["innerHTML"],da=["src"],ua=j({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const v=i=>(i=i.replace(/\n/g,"<br>"),new DOMParser().parseFromString(i,"text/html").body.innerHTML);return(i,r)=>(l(),d("div",ea,[t.is_sender?(l(),d("div",oa,[e("div",ia,[e("p",ra,x(t.direction),1),e("div",{class:"info-content",innerHTML:v(t.content)},null,8,ca)]),e("img",{src:t.headUrl},null,8,da)])):(l(),d("div",ta,[e("img",{src:t.headUrl},null,8,aa),e("div",sa,[e("p",la,x(t.direction),1),e("div",{class:"info-content",innerHTML:v(t.content)},null,8,na)])]))]))}}),_a=L(ua,[["__scopeId","data-v-e529325a"]]),ha={id:"chat"},ma={class:"chat_body"},fa={class:"chat_window",ref:"chatWindow"},pa={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},va=j({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(t,{expose:v}){const i=t,r=m([]),h=m({}),$=m(!1),u=m(""),s=m(0),c=m(100),b=m(0),w=m(!1),D=async(g,C,T)=>{if($.value){console.log("正在获取消息，请稍后再试!");return}if(T==""){console.log("wxid 为空, 请检查!");return}try{$.value=!0,g<0&&(g=0);const n=await O.post("/api/msgs",{start:g,limit:C,wxid:T});return r.value=n.msg_list,h.value=Object.assign(h.value,n.user_list),$.value=!1,n}catch(n){return $.value=!1,console.error("Error fetching data:",n),[]}},z=async g=>{try{return(await O.post("/api/msg_count",{wxid:g}))[g]}catch(C){return console.error("Error fetching data msg_count:",C),[]}},p=async()=>{try{return(await O.get("/api/mywxid")).my_wxid}catch(g){return console.error("Error fetching data my_wxid:",g),[]}},U=async()=>{try{u.value=await p(),b.value=await z(i.userData.wxid),s.value=b.value-c.value,s.value<0&&(s.value=0),await D(s.value,c.value,i.userData.wxid),w.value||await K(()=>{i.setScrollTop(),w.value=!1})}catch(g){return console.error("Error fetching data:",g),[]}};J(()=>i.userData.wxid,(g,C)=>{console.log("username changed： ",C,g),r.value=[],h.value={},w.value=!1,b.value=0,s.value=0,U()});const H=async()=>{u.value=await p(),b.value=await z(i.userData.wxid);let g=c.value,C=s.value-g;const T=await D(C,g,i.userData.wxid);s.value=C,console.log("loadMore",C,s.value,g,i.userData.wxid),r.value=T.msg_list.concat(r.value),r.value.sort((n,f)=>n.id-f.id),r.value=r.value.filter((n,f,y)=>f===0||n.id!==y[f-1].id),h.value=Object.assign(h.value,T.user_list),await K(()=>{i.updateScrollTop()})};v({loadMore:H});const R=g=>(g.talker=="我"&&(g.talker=u.value),`${(T=>h.value.hasOwnProperty(T.talker)?h.value[T.talker].remark?h.value[T.talker].remark:h.value[T.talker].nickname?h.value[T.talker].nickname:h.value[T.talker].account?h.value[T.talker].account:T.talker:T.talker)(g)} [${g.type_name}] ${g.CreateTime}`),S=g=>(g.talker=="我"&&(g.talker=u.value),h.value.hasOwnProperty(g.talker)?"/api/imgsrc/"+h.value[g.talker].headImgUrl:"");return(g,C)=>{const T=k("el-button");return l(),d("div",ha,[e("div",ma,[e("div",fa,[r.value.length<b.value?(l(),d("div",pa,[a(T,{type:"primary",onClick:H},{default:o(()=>[_("查看更多消息")]),_:1})])):I("",!0),(l(!0),d(G,null,X(r.value,(n,f)=>(l(),d("div",{class:"message",key:f},[n.type_name=="文本"?(l(),E(He,{key:0,is_sender:n.is_sender,direction:R(n),headUrl:S(n),content:n.content.msg},null,8,["is_sender","direction","headUrl","content"])):n.type_name=="图片"?(l(),E(We,{key:1,is_sender:n.is_sender,direction:R(n),headUrl:S(n),src:"/api/img/"+n.content.src},null,8,["is_sender","direction","headUrl","src"])):n.type_name=="动画表情"?(l(),E(Zt,{key:2,is_sender:n.is_sender,direction:R(n),headUrl:S(n),src:"/api/imgsrc/"+n.content.src},null,8,["is_sender","direction","headUrl","src"])):n.type_name=="视频"?(l(),E(dt,{key:3,is_sender:n.is_sender,direction:R(n),headUrl:S(n),src:"/api/video/"+n.content.src},null,8,["is_sender","direction","headUrl","src"])):n.type_name=="文件"?(l(),E(Lt,{key:4,is_sender:n.is_sender,direction:R(n),headUrl:S(n),src:n.content.src},null,8,["is_sender","direction","headUrl","src"])):n.type_name=="语音"?(l(),E(St,{key:5,is_sender:n.is_sender,direction:R(n),headUrl:S(n),src:"/api/"+n.content.src,msg:n.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(l(),E(_a,{key:6,is_sender:n.is_sender,direction:R(n),headUrl:S(n),content:n.content.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),ya=L(va,[["__scopeId","data-v-09ca318b"]]),wa=j({__name:"DateTimeSelect",emits:["datetime"],setup(t,{emit:v}){const i=[new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)],r=[{text:"全部",value:()=>{const u=new Date;return[new Date(2010,0,1,0,0,0),u]}},{text:"最近一周",value:()=>{const u=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*7),[s,u]}},{text:"最近一个月",value:()=>{const u=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*30),[s,u]}},{text:"最近三个月",value:()=>{const u=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*90),[s,u]}},{text:"最近半年",value:()=>{const u=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*180),[s,u]}},{text:"最近一年",value:()=>{const u=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*365),[s,u]}},{text:"去年一整年",value:()=>{const u=new Date;u.setFullYear(u.getFullYear()-1),u.setMonth(0),u.setDate(1),u.setHours(0,0,0);const s=new Date;return s.setFullYear(s.getFullYear()-1),s.setMonth(11),s.setDate(31),s.setHours(23,59,59),[u,s]}}],h=m([Date,Date]),$=v;return J(()=>h.value,(u,s)=>{let c=u[0].getTime(),b=u[1].getTime();$("datetime",[c,b])}),(u,s)=>{const c=k("el-date-picker");return l(),E(c,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=b=>h.value=b),type:"datetimerange",shortcuts:r,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","default-time":i,format:"YYYY-MM-DD HH:mm"},null,8,["modelValue"])}}}),ga=L(wa,[["__scopeId","data-v-320582f6"]]),xa={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},ba={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},ka={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},$a=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Sa={style:{"margin-top":"20px"}},Da=e("br",null,null,-1),Ta=e("br",null,null,-1),Ua=e("br",null,null,-1),Va={key:0},Ca={key:1},Ma=e("strong",null,"** 时间(默认全部)：",-1),Ea={key:2},za={key:3},Ha={key:4},Ra=j({__name:"ChatExportMain",props:{userData:{type:Object,required:!0}},setup(t){const v=t,i=m(""),r=m([]),h=m(["文本"]),$=m(""),u=m(""),s=m(""),c={endb:{brief:"加密文件",detail:`导出的内容为微信加密数据库（）。
可还原回微信,但会覆盖微信后续消息。`,userShow:!1,timeShow:!1,chatTypeShow:!1,keyShow:!1,wxPathShow:!0},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。",userShow:!1,timeShow:!0,chatTypeShow:!1,keyShow:!1,wxPathShow:!1},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。",userShow:!0,timeShow:!1,chatTypeShow:!1,keyShow:!1,wxPathShow:!1},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。",userShow:!0,timeShow:!1,chatTypeShow:!1,keyShow:!1,wxPathShow:!1},html:{brief:"html-测试中",detail:"主要用于浏览器可视化查看。",userShow:!0,timeShow:!1,chatTypeShow:!1,keyShow:!1,wxPathShow:!1},pdf:{brief:"pdf-开发中",detail:"就是html的pdf版本。",userShow:!0,timeShow:!0,chatTypeShow:!0,keyShow:!1,wxPathShow:!0},docx:{brief:"docx-开发中",detail:"就是html的docx版本。",userShow:!0,timeShow:!0,chatTypeShow:!0,keyShow:!1,wxPathShow:!0}},b=["文本","图片","语音","视频","动画表情","文件","卡片式链接","用户上传的GIF表情","转账消息","赠送红包封面","语音通话","系统通知","拍一拍","系统通知","其他"],w=m(!1),D=m(!0),z=n=>{h.value=n?b:[],D.value=!1},p=n=>{const f=n.length;w.value=f===b.length,D.value=f>0&&f<b.length},U=n=>{r.value=n},H=m(!1),R=m(!1),S=m(!1),g=m(!1),C=m(!1);J(i,n=>{H.value=c[n].userShow,R.value=c[n].timeShow,S.value=c[n].chatTypeShow,g.value=c[n].keyShow,C.value=c[n].wxPathShow,s.value=c[n].detail});const T=async()=>{try{if(i.value===""){s.value="导出类型不能为空";return}const n=await O.post("/api/export",{export_type:i.value,start_time:r.value[0],end_time:r.value[1],chat_type:h.value,username:v.userData.username,wx_path:u.value});s.value=n}catch(n){W.alert(n,"error",{confirmButtonText:"确认",callback:f=>{ne({type:"error",message:`action: ${f}`})}}),s.value=String(n)+`
更多信息请查看控制台；`}};return(n,f)=>{const y=k("el-option"),N=k("el-select"),q=k("el-text"),P=k("el-col"),V=k("el-row"),ee=k("el-checkbox"),oe=k("el-checkbox-group"),Q=k("el-input"),ie=k("el-button"),re=k("el-divider"),ce=k("el-main");return l(),d("div",xa,[a(ce,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:o(()=>[e("div",ba,[e("div",ka,[$a,e("div",Sa,[_(" 导出类型: "),a(N,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=M=>i.value=M)},{default:o(()=>[(l(),d(G,null,X(c,(M,te)=>a(y,{label:M.brief,value:te,key:te},{default:o(()=>[_(x(M.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Da,Ta,e("div",null,[_(" 选项:"),Ua,H.value?(l(),d("div",Va,[_(" ** 用户(默认全部，从左边选择具体用户)： "),a(V,{gutter:5,style:{width:"100%"}},{default:o(()=>[a(P,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(q,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("原始id:")]),_:1}),_("  "),a(q,{class:"data_color mx-1",truncated:""},{default:o(()=>[_(x(t.userData.wxid),1)]),_:1})]),_:1}),a(P,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(q,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("账号:")]),_:1}),_("  "),a(q,{class:"data_color mx-1",truncated:""},{default:o(()=>[_(x(t.userData.account),1)]),_:1})]),_:1}),a(P,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(q,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("昵称:")]),_:1}),_("  "),a(q,{class:"data_color mx-1",truncated:""},{default:o(()=>[_(x(t.userData.nickname),1)]),_:1})]),_:1}),a(P,{span:6,style:{"white-space":"nowrap"}},{default:o(()=>[a(q,{class:"label_color mx-1",truncated:""},{default:o(()=>[_("备注:")]),_:1}),_("  "),a(q,{class:"data_color mx-1",truncated:""},{default:o(()=>[_(x(t.userData.remark),1)]),_:1})]),_:1})]),_:1})])):I("",!0),R.value?(l(),d("div",Ca,[Ma,a(ga,{onDatetime:U})])):I("",!0),S.value?(l(),d("div",Ea,[_(" ** 消息类型： "),a(ee,{modelValue:w.value,"onUpdate:modelValue":f[1]||(f[1]=M=>w.value=M),indeterminate:D.value,onChange:z},{default:o(()=>[_("全选 ")]),_:1},8,["modelValue","indeterminate"]),a(oe,{modelValue:h.value,"onUpdate:modelValue":f[2]||(f[2]=M=>h.value=M),onChange:p},{default:o(()=>[(l(),d(G,null,X(b,M=>a(ee,{key:M,label:M},{default:o(()=>[_(x(M),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])):I("",!0),g.value?(l(),d("div",za,[_(" ** 微信文件夹路径： "),a(Q,{placeholder:"密钥key[可为空]",modelValue:$.value,"onUpdate:modelValue":f[3]||(f[3]=M=>$.value=M),style:{width:"50%"}},null,8,["modelValue"])])):I("",!0),C.value?(l(),d("div",Ha,[_(" ** 微信文件夹路径： "),a(Q,{placeholder:"微信文件夹路径[可为空](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:u.value,"onUpdate:modelValue":f[4]||(f[4]=M=>u.value=M),style:{width:"50%"}},null,8,["modelValue"])])):I("",!0)]),a(ie,{style:{"margin-top":"10px",width:"50%"},type:"success",onClick:T},{default:o(()=>[_("导出")]),_:1}),a(re),a(Q,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:s.value,"onUpdate:modelValue":f[5]||(f[5]=M=>s.value=M),style:{width:"100%"}},null,8,["modelValue"])])])])]),_:1})])}}}),Ia=j({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(t){const v=m(null),i=m(null);m(0);const r=m(0),h=()=>{K(()=>{if(v.value){const p=v.value.$el.children[0];p&&(p.scrollTop=p.scrollHeight,r.value=p.scrollHeight)}})},$=()=>{const p=v.value.$el.children[0];if(p){const U=r.value,H=p.scrollHeight-U;p.scrollTop=p.scrollTop+H,r.value=p.scrollHeight}};function u({scrollTop:p}){p===0&&i.value&&i.value.loadMore()}const s=t,c=m({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",wxid:"",msg_count:0}),b=async()=>{try{const p=await O.post("/api/wxid2user",{wxid:s.wxid});return c.value.account=p[s.wxid].account,c.value.describe=p[s.wxid].describe,c.value.headImgUrl=p[s.wxid].headImgUrl,c.value.nickname=p[s.wxid].nickname,c.value.remark=p[s.wxid].remark,c.value.wxid=s.wxid,p}catch(p){return console.error("Error fetching data wxid2user :",p),[]}},w=async()=>{try{const p=await O.post("/api/msg_count",{wxid:s.wxid});return c.value.msg_count=p[s.wxid],p}catch(p){return console.error("Error fetching data msg_count:",p),[]}};Z(()=>{w(),b(),K(()=>{h()})});const D=m(!1),z=p=>{D.value=p,console.log("is_export:",D.value)};return J(()=>s.wxid,async(p,U)=>{p!==U&&(b(),w(),D.value=!1,K(()=>{h()}))}),(p,U)=>{const H=k("el-header"),R=k("el-scrollbar"),S=k("el-main"),g=k("el-container");return l(),E(g,null,{default:o(()=>[a(H,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:o(()=>[a(xe,{userData:c.value,onExporting:z},null,8,["userData"])]),_:1}),a(S,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:o(()=>[a(R,{ref_key:"scrollbarRef",ref:v,onScroll:u},{default:o(()=>[D.value?(l(),E(Ra,{key:0,userData:c.value},null,8,["userData"])):(l(),E(ya,{key:1,ref_key:"chatRecordsMainRef",ref:i,userData:c.value,setScrollTop:h,updateScrollTop:$},null,8,["userData"]))]),_:1},512)]),_:1})]),_:1})}}}),ja={class:"progress-bar"},le=j({__name:"ProgressBar",props:{startORstop:{type:Number,required:!0}},setup(t){const v=m(0),i=m(500),r=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],h=m(new Date().getTime()),$=t,u=()=>{if($.startORstop===1){v.value=100;return}h.value=new Date().getTime(),!(v.value>=99)&&(v.value>=80&&(i.value=i.value+50),v.value=v.value+1,setTimeout(u,i.value))};return u(),(s,c)=>{const b=k("el-progress");return l(),d("div",ja,[a(b,{type:"dashboard",percentage:v.value,color:r},null,8,["percentage"])])}}}),Oa={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},qa={key:0},La={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},Pa=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),Fa={style:{"margin-top":"20px"}},Na={style:{"margin-top":"20px"}},Ba={key:1},Aa={key:0},Ya={key:1,style:{"background-color":"#fff",width:"80%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Wa=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Ka={style:{"margin-top":"20px"}},Ga={key:0},Ja={key:1},Qa={key:2},Xa=e("label",null,"merge_all.db 路径: ",-1),Za=e("br",null,null,-1),es=e("label",null,"微信文件夹路径: ",-1),ts=e("br",null,null,-1),as=e("label",null,"微信原始id: ",-1),ss=e("br",null,null,-1),ls={key:3},ns=e("label",null,"密钥key(可空): ",-1),os=e("br",null,null,-1),is={key:2},rs={key:3,style:{display:"flex","justify-content":"space-between"}},cs={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},ds=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"使用上次设置")],-1),us={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},_s=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),hs={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},ms=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),fs=j({__name:"IsAutoShow",emits:["isAutoShow"],setup(t,{emit:v}){const i=m(0),r=m(-1),h=m(""),$=m(!1),u=m([]),s=m(""),c=m(!1),b=m(!1),w=m("false"),D=m(""),z=m(""),p=m(""),U=m(""),H=v,R=async()=>{try{u.value=await O.post("/api/wxinfo"),u.value.length===1&&(S(u.value[0]),s.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(g,5e3))}catch(f){return console.error("Error fetching data:",f),[]}},S=async f=>{D.value="",z.value=f.filePath,p.value=f.key,U.value=f.wxid},g=()=>{z.value===""&&p.value===""&&U.value===""||c.value||(c.value=!0,C())},C=async()=>{if(!c.value)try{c.value=!0,r.value=0;let f={wx_path:z.value,key:p.value,my_wxid:U.value};const y=await O.post("/api/init_key",f);$.value=y.is_init,y.is_init&&(i.value=100,c.value=!1),H("isAutoShow",y.is_init)}catch(f){return i.value=0,b.value=!0,W.alert(f,"error",{confirmButtonText:"确认",callback:y=>{ne({type:"error",message:`action: ${y}`})}}),[]}},T=async()=>{try{let f={wx_path:z.value,merge_path:D.value,my_wxid:U.value};const y=await O.post("/api/init_nokey",f);$.value=y.is_init,y.is_init&&(i.value=100,c.value=!1),H("isAutoShow",y.is_init)}catch(f){return i.value=0,b.value=!0,W.alert(f,"error",{confirmButtonText:"确认",callback:y=>{h.value=""}}),[]}},n=async()=>{try{let f={wx_path:z.value,merge_path:D.value,my_wxid:U.value};const y=await O.post("/api/init_last",f);$.value=y.is_init,y.is_init?(i.value=100,c.value=!1,H("isAutoShow",y.is_init)):(b.value=!0,W.alert("未发现上次的设置数据！","error",{confirmButtonText:"确认",callback:N=>{h.value=""}}))}catch(f){return b.value=!0,W.alert(f,"error",{confirmButtonText:"确认",callback:y=>{h.value=""}}),[]}};return J(h,f=>{f==="auto"?R():f==="custom"||f==="last"&&n()}),(f,y)=>{const N=k("el-button"),q=k("el-divider"),P=k("el-input");return l(),d("div",Oa,[h.value==="auto"?(l(),d("div",qa,[c.value?(l(),E(le,{key:0,startORstop:r.value},null,8,["startORstop"])):(l(),d("div",La,[Pa,e("div",Fa,[a(F(_e),{data:u.value,onCurrentChange:S,"highlight-current-row":"",style:{width:"100%"}},{default:o(()=>[a(F(B),{"min-width":30,prop:"pid",label:"进程id"}),a(F(B),{"min-width":40,prop:"version",label:"微信版本"}),a(F(B),{"min-width":40,prop:"account",label:"账号"}),a(F(B),{"min-width":40,prop:"name",label:"昵称"}),a(F(B),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",Na,[a(N,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:g},{default:o(()=>[_("确定"+x(s.value),1)]),_:1})])]))])):h.value==="custom"?(l(),d("div",Ba,[c.value?(l(),d("div",Aa,[c.value?(l(),E(le,{key:0,startORstop:r.value},null,8,["startORstop"])):I("",!0)])):(l(),d("div",Ya,[Wa,e("div",Ka,[A(e("input",{type:"radio","onUpdate:modelValue":y[0]||(y[0]=V=>w.value=V),value:"true"},null,512),[[Y,w.value]]),_(" 使用 KEY          "),A(e("input",{type:"radio","onUpdate:modelValue":y[1]||(y[1]=V=>w.value=V),value:"false"},null,512),[[Y,w.value]]),_(" 不使用 KEY "),w.value=="false"?(l(),d("div",Ga," 说明：1、表示数据库已解密    2、若使用导出后的merge数据库，则db路径写这个即可 ")):I("",!0),w.value=="true"?(l(),d("div",Ja," 说明：自动根据key解密微信文件夹下的数据库 ")):I("",!0),a(q),w.value=="false"?(l(),d("div",Qa,[Xa,a(P,{placeholder:"MediaMSG.db",modelValue:D.value,"onUpdate:modelValue":y[2]||(y[2]=V=>D.value=V),style:{width:"80%"}},null,8,["modelValue"]),Za])):I("",!0),es,a(P,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:z.value,"onUpdate:modelValue":y[3]||(y[3]=V=>z.value=V),style:{width:"80%"}},null,8,["modelValue"]),ts,as,a(P,{placeholder:"wxid_*******",modelValue:U.value,"onUpdate:modelValue":y[4]||(y[4]=V=>U.value=V),style:{width:"80%"}},null,8,["modelValue"]),ss,w.value=="true"?(l(),d("div",ls,[ns,a(P,{placeholder:"密钥key (64位)",modelValue:p.value,"onUpdate:modelValue":y[5]||(y[5]=V=>p.value=V),style:{width:"80%"}},null,8,["modelValue"]),os])):I("",!0),w.value=="true"?(l(),E(N,{key:4,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:C},{default:o(()=>[_(" 确定 ")]),_:1})):I("",!0),w.value=="false"?(l(),E(N,{key:5,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:T},{default:o(()=>[_(" 确定 ")]),_:1})):I("",!0)])]))])):h.value==="last"?(l(),d("div",is)):h.value===""?(l(),d("div",rs,[e("label",cs,[A(e("input",{type:"radio","onUpdate:modelValue":y[6]||(y[6]=V=>h.value=V),value:"last"},null,512),[[Y,h.value]]),ds]),e("label",us,[A(e("input",{type:"radio","onUpdate:modelValue":y[7]||(y[7]=V=>h.value=V),value:"auto"},null,512),[[Y,h.value]]),_s]),e("label",hs,[A(e("input",{type:"radio","onUpdate:modelValue":y[8]||(y[8]=V=>h.value=V),value:"custom"},null,512),[[Y,h.value]]),ms])])):I("",!0)])}}}),ps={id:"chat_view",class:"common-layout"},vs={key:0},ys={key:1},ws={key:0,style:{height:"calc(100vh)",width:"100%"}},gs={key:1,style:{width:"100%",height:"100%"}},Ss=j({__name:"ChatView",setup(t){const v=m(!1),i=$=>{v.value=$},r=m(""),h=$=>{r.value=$};return($,u)=>{const s=k("el-aside"),c=k("el-container");return l(),d("div",ps,[v.value?(l(),d("div",ys,[a(c,null,{default:o(()=>[a(s,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:o(()=>[a(we,{onWxid:h})]),_:1}),r.value!=""?(l(),d("div",ws,[a(Ia,{wxid:r.value},null,8,["wxid"])])):(l(),d("div",gs,[a(he)]))]),_:1})])):(l(),d("div",vs,[a(fs,{onIsAutoShow:i})]))])}}});export{Ss as default};
