<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Design &mdash; Gunicorn 21.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="Custom Application" href="custom.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Gunicorn
          </a>
              <div class="version">
                21.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running Gunicorn</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure.html">Configuration Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrumentation.html">Instrumentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Deploying Gunicorn</a></li>
<li class="toctree-l1"><a class="reference internal" href="signals.html">Signal Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom.html">Custom Application</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#server-model">Server Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#master">Master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sync-workers">Sync Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#async-workers">Async Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gthread-workers">Gthread Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tornado-workers">Tornado Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asyncio-workers">AsyncIO Workers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#choosing-a-worker-type">Choosing a Worker Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-many-workers">How Many Workers?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-many-threads">How Many Threads?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="news.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Gunicorn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Design</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/design.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="design">
<span id="id1"></span><h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>A brief description of the architecture of Gunicorn.</p>
<section id="server-model">
<h2>Server Model<a class="headerlink" href="#server-model" title="Permalink to this heading">¶</a></h2>
<p>Gunicorn is based on the pre-fork worker model. This means that there is a
central master process that manages a set of worker processes. The master
never knows anything about individual clients. All requests and responses are
handled completely by worker processes.</p>
<section id="master">
<h3>Master<a class="headerlink" href="#master" title="Permalink to this heading">¶</a></h3>
<p>The master process is a simple loop that listens for various process signals
and reacts accordingly. It manages the list of running workers by listening
for signals like TTIN, TTOU, and CHLD. TTIN and TTOU tell the master to
increase or decrease the number of running workers. CHLD indicates that a child
process has terminated, in this case the master process automatically restarts
the failed worker.</p>
</section>
<section id="sync-workers">
<h3>Sync Workers<a class="headerlink" href="#sync-workers" title="Permalink to this heading">¶</a></h3>
<p>The most basic and the default worker type is a synchronous worker class that
handles a single request at a time. This model is the simplest to reason about
as any errors will affect at most a single request. Though as we describe below
only processing a single request at a time requires some assumptions about how
applications are programmed.</p>
<p><code class="docutils literal notranslate"><span class="pre">sync</span></code> worker does not support persistent connections - each connection is
closed after response has been sent (even if you manually add <code class="docutils literal notranslate"><span class="pre">Keep-Alive</span></code>
or <code class="docutils literal notranslate"><span class="pre">Connection:</span> <span class="pre">keep-alive</span></code> header in your application).</p>
</section>
<section id="async-workers">
<h3>Async Workers<a class="headerlink" href="#async-workers" title="Permalink to this heading">¶</a></h3>
<p>The asynchronous workers available are based on <a class="reference external" href="https://github.com/python-greenlet/greenlet">Greenlets</a> (via <a class="reference external" href="http://eventlet.net/">Eventlet</a> and
<a class="reference external" href="http://www.gevent.org/">Gevent</a>). Greenlets are an implementation of cooperative multi-threading for
Python. In general, an application should be able to make use of these worker
classes with no changes.</p>
<p>For full greenlet support applications might need to be adapted.
When using, e.g., <a class="reference external" href="http://www.gevent.org/">Gevent</a> and <a class="reference external" href="http://initd.org/psycopg/">Psycopg</a> it makes sense to ensure <a class="reference external" href="https://github.com/psycopg/psycogreen/">psycogreen</a> is
installed and <a class="reference external" href="http://www.gevent.org/api/gevent.monkey.html#plugins">setup</a>.</p>
<p>Other applications might not be compatible at all as they, e.g., rely on
the original unpatched behavior.</p>
</section>
<section id="gthread-workers">
<h3>Gthread Workers<a class="headerlink" href="#gthread-workers" title="Permalink to this heading">¶</a></h3>
<p>The worker <cite>gthread</cite> is a threaded worker. It accepts connections in the
main loop. Accepted connections are added to the thread pool as a
connection job. On keepalive connections are put back in the loop
waiting for an event. If no event happens after the keepalive timeout,
the connection is closed.</p>
</section>
<section id="tornado-workers">
<h3>Tornado Workers<a class="headerlink" href="#tornado-workers" title="Permalink to this heading">¶</a></h3>
<p>There’s also a Tornado worker class. It can be used to write applications using
the Tornado framework. Although the Tornado workers are capable of serving a
WSGI application, this is not a recommended configuration.</p>
</section>
<section id="asyncio-workers">
<span id="id2"></span><h3>AsyncIO Workers<a class="headerlink" href="#asyncio-workers" title="Permalink to this heading">¶</a></h3>
<p>These workers are compatible with Python 3.</p>
<p>You can port also your application to use <a class="reference external" href="https://docs.aiohttp.org/en/stable/deployment.html#nginx-gunicorn">aiohttp</a>’s <code class="docutils literal notranslate"><span class="pre">web.Application</span></code> API and use the
<code class="docutils literal notranslate"><span class="pre">aiohttp.worker.GunicornWebWorker</span></code> worker.</p>
</section>
</section>
<section id="choosing-a-worker-type">
<h2>Choosing a Worker Type<a class="headerlink" href="#choosing-a-worker-type" title="Permalink to this heading">¶</a></h2>
<p>The default synchronous workers assume that your application is resource-bound
in terms of CPU and network bandwidth. Generally this means that your
application shouldn’t do anything that takes an undefined amount of time. An
example of something that takes an undefined amount of time is a request to the
internet. At some point the external network will fail in such a way that
clients will pile up on your servers. So, in this sense, any web application
which makes outgoing requests to APIs will benefit from an asynchronous worker.</p>
<p>This resource bound assumption is why we require a buffering proxy in front of
a default configuration Gunicorn. If you exposed synchronous workers to the
internet, a DOS attack would be trivial by creating a load that trickles data to
the servers. For the curious, <a class="reference external" href="https://github.com/rakyll/hey">Hey</a> is an example of this type of load.</p>
<p>Some examples of behavior requiring asynchronous workers:</p>
<blockquote>
<div><ul class="simple">
<li><p>Applications making long blocking calls (Ie, external web services)</p></li>
<li><p>Serving requests directly to the internet</p></li>
<li><p>Streaming requests and responses</p></li>
<li><p>Long polling</p></li>
<li><p>Web sockets</p></li>
<li><p>Comet</p></li>
</ul>
</div></blockquote>
</section>
<section id="how-many-workers">
<h2>How Many Workers?<a class="headerlink" href="#how-many-workers" title="Permalink to this heading">¶</a></h2>
<p>DO NOT scale the number of workers to the number of clients you expect to have.
Gunicorn should only need 4-12 worker processes to handle hundreds or thousands
of requests per second.</p>
<p>Gunicorn relies on the operating system to provide all of the load balancing
when handling requests. Generally we recommend <code class="docutils literal notranslate"><span class="pre">(2</span> <span class="pre">x</span> <span class="pre">$num_cores)</span> <span class="pre">+</span> <span class="pre">1</span></code> as the
number of workers to start off with. While not overly scientific, the formula
is based on the assumption that for a given core, one worker will be reading
or writing from the socket while the other worker is processing a request.</p>
<p>Obviously, your particular hardware and application are going to affect the
optimal number of workers. Our recommendation is to start with the above guess
and tune using TTIN and TTOU signals while the application is under load.</p>
<p>Always remember, there is such a thing as too many workers. After a point your
worker processes will start thrashing system resources decreasing the
throughput of the entire system.</p>
</section>
<section id="how-many-threads">
<h2>How Many Threads?<a class="headerlink" href="#how-many-threads" title="Permalink to this heading">¶</a></h2>
<p>Since Gunicorn 19, a threads option can be used to process requests in multiple
threads. Using threads assumes use of the gthread worker. One benefit from threads
is that requests can take longer than the worker timeout while notifying the
master process that it is not frozen and should not be killed. Depending on the
system, using multiple threads, multiple worker processes, or some mixture, may
yield the best results. For example, CPython may not perform as well as Jython
when using threads, as threading is implemented differently by each. Using
threads instead of processes is a good way to reduce the memory footprint of
Gunicorn, while still allowing for application upgrades using the reload
signal, as the application code will be shared among workers but loaded only in
the worker processes (unlike when using the preload setting, which loads the
code in the master process).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Under Python 2.x, you need to install the ‘futures’ package to use this
feature.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="custom.html" class="btn btn-neutral float-left" title="Custom Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2023, Benoit Chesneau.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>